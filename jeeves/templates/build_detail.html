{% extends "base.html" %}
{% block title %}Jeeves - {{ project.name }} - Build #{{ object.id }}{% endblock %}

{% block content %}
<div class="container">
  <ol class="breadcrumb">
    <li><a href="{% url 'build-list' project_slug=project.slug %}">{{ project.name }}</a></li>
    <li class="active">Build #{{ object.build_id }}</li>
  </ol>

  {% include "partials/build_detail_header.html" with build=build %}

  <div class="panel panel-default">
    <div class="panel-heading clearfix">
      <h4 class="pull-left">Log</h4>
      <a href="{% url 'build-log' project_slug=project.slug build_id=build.build_id %}"
         role="button" class="pull-right btn btn-default" target="_blank">
        <span class="glyphicon glyphicon-new-window">
      </a>
    </div>
      <div class="panel-body">
        <pre class="pre-scrollable">{{ object.get_log }}</pre>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block js %}
swampdragon.ready(function() {
  setInterval(function () {
    swampdragon.callRouter('get_detail_header', 'build-changes', {id: {{ build.id }}},
      function(context, data) {
        console.log(data);
        if (data.html == null) {
          return;
        }
        $('#build-' + {{ build.id }}).replaceWith(data.html);
      });
  }, 1000);
});
{% endblock %}
