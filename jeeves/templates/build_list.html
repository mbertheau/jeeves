{% extends "base.html" %}
{% block title %}Jeeves - {{ project.name }} - Builds{% endblock %}

{% block content %}
<div class="container-fluid" style="margin:0.2em">
  <h2 class="page-header">{{ project.name }}
      {% if perms.can_edit_project %}
        <a href="{% url 'admin:core_project_change' project.id %}"
           role="button" class="pull-right btn btn-default">
          <span class="glyphicon glyphicon-edit">
        </a>
      {% endif %}
  </h2>

  <div class="row" style="margin:0.2em">
    <div class="panel panel-default col-lg-6">
      <div class="panel-body">
        {{ project.description }}
      </div>
    </div>
    <div class="col-lg-6">
    </div>
  </div>

  <h3>Builds</h3>
  <div class="table-responsive">
    <table class="table table-striped">
      <tbody>
      {% for build in object_list %}
        {% ifchanged %}<tr><td colspan="5" class="h5"><strong>{{ build.creation_time|date:"DATE_FORMAT" }}</strong></td></tr>{% endifchanged %}
        {% include "partials/build_list_row.html" with build=build %}
      {% empty %}
        <tr><td>No builds yet.</td></tr>
      {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}

{% block js %}
swampdragon.onChannelMessage(function (channels, message) {
  console.log(message.data);
  if (message.data.refresh_needed) {
    window.location.reload();
  }
  var i;
  for (i = 0; i < message.data.build_list_changes.length; ++i) {
    var build_data = message.data.build_list_changes[i];
    var element = $('#build-' + build_data.id);
    if (element == null) {
      continue;
    }
    element.replaceWith(build_data.html);
  }
});

swampdragon.ready(function() {
  swampdragon.subscribe('build-changes', 'build-list', null);
});
{% endblock %}
